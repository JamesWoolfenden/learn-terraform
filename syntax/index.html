<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="James Woolfenden"><link rel="shortcut icon" href=../assets/images/favicon.ico><meta name=generator content="mkdocs-1.1.2, mkdocs-material-6.2.8"><title>Syntax - Learn Terraform</title><link rel=stylesheet href=../assets/stylesheets/main.cb6bc1d0.min.css><link rel=stylesheet href=../assets/stylesheets/palette.39b8e14a.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=manifest href=../manifest.webmanifest crossorigin=use-credentials><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-151885688-1","jameswoolfenden.github.io/learn-terraform/"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#terraform-hcl-syntax-primer class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=.. title="Learn Terraform" class="md-header-nav__button md-logo" aria-label="Learn Terraform"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <div class=md-header-nav__topic> <span class=md-ellipsis> Learn Terraform </span> </div> <div class=md-header-nav__topic> <span class=md-ellipsis> Syntax </span> </div> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/jamesWoolfenden/learn-terraform/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> jamesWoolfenden/learn-terraform </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../examples/ class=md-tabs__link> Examples </a> </li> <li class=md-tabs__item> <a href=../install/ class=md-tabs__link> Install </a> </li> <li class=md-tabs__item> <a href=../state/ class=md-tabs__link> State </a> </li> <li class=md-tabs__item> <a href=./ class="md-tabs__link md-tabs__link--active"> Syntax </a> </li> <li class=md-tabs__item> <a href=../local_file/ class=md-tabs__link> Providers </a> </li> <li class=md-tabs__item> <a href=../aws-vpc/ class=md-tabs__link> Making a VPC </a> </li> <li class=md-tabs__item> <a href=../aws-subnet/ class=md-tabs__link> Creating a Subnet </a> </li> <li class=md-tabs__item> <a href=../aws-instance/ class=md-tabs__link> Creating an Instance </a> </li> <li class=md-tabs__item> <a href=../aws-autoscaling/ class=md-tabs__link> Autoscaling </a> </li> <li class=md-tabs__item> <a href=../aws-alb/ class=md-tabs__link> Load Balancing </a> </li> <li class=md-tabs__item> <a href=../aws-rds/ class=md-tabs__link> Databases </a> </li> <li class=md-tabs__item> <a href=../aws-s3/ class=md-tabs__link> Storage </a> </li> <li class=md-tabs__item> <a href=../aws-iam/ class=md-tabs__link> IAM </a> </li> <li class=md-tabs__item> <a href=../aws-dns/ class=md-tabs__link> DNS </a> </li> <li class=md-tabs__item> <a href=../adv-state/ class=md-tabs__link> Advanced State </a> </li> <li class=md-tabs__item> <a href=../control/ class=md-tabs__link> Structure </a> </li> <li class=md-tabs__item> <a href=../module/ class=md-tabs__link> Modules </a> </li> <li class=md-tabs__item> <a href=../aws-codecommit/ class=md-tabs__link> SourceCode </a> </li> <li class=md-tabs__item> <a href=../aws-ecr/ class=md-tabs__link> Containers </a> </li> <li class=md-tabs__item> <a href=../aws-cloudwatch/ class=md-tabs__link> Logging </a> </li> <li class=md-tabs__item> <a href=../workspaces/ class=md-tabs__link> Workspaces </a> </li> <li class=md-tabs__item> <a href=../tfe/ class=md-tabs__link> Terraform cloud </a> </li> <li class=md-tabs__item> <a href=../extending/ class=md-tabs__link> Extending </a> </li> <li class=md-tabs__item> <a href=../failings/ class=md-tabs__link> Failings </a> </li> <li class=md-tabs__item> <a href=../style-guide/ class=md-tabs__link> Style Guide </a> </li> <li class=md-tabs__item> <a href=../help/ class=md-tabs__link> Help </a> </li> <li class=md-tabs__item> <a href=../about/ class=md-tabs__link> About </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Learn Terraform" class="md-nav__button md-logo" aria-label="Learn Terraform"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> Learn Terraform </label> <div class=md-nav__source> <a href=https://github.com/jamesWoolfenden/learn-terraform/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> jamesWoolfenden/learn-terraform </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../examples/ class=md-nav__link> Examples </a> </li> <li class=md-nav__item> <a href=../install/ class=md-nav__link> Install </a> </li> <li class=md-nav__item> <a href=../state/ class=md-nav__link> State </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Syntax <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Syntax </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#provisioners class=md-nav__link> Provisioners </a> <nav class=md-nav aria-label=Provisioners> <ul class=md-nav__list> <li class=md-nav__item> <a href=#connections class=md-nav__link> Connections </a> </li> <li class=md-nav__item> <a href=#connection-forwarding class=md-nav__link> Connection forwarding </a> </li> <li class=md-nav__item> <a href=#remote-exec class=md-nav__link> Remote-Exec </a> </li> <li class=md-nav__item> <a href=#local-exec class=md-nav__link> Local-exec </a> </li> <li class=md-nav__item> <a href=#file-provisioning class=md-nav__link> File Provisioning </a> </li> <li class=md-nav__item> <a href=#triggers class=md-nav__link> Triggers </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#resources class=md-nav__link> Resources </a> </li> <li class=md-nav__item> <a href=#providers class=md-nav__link> Providers </a> <nav class=md-nav aria-label=Providers> <ul class=md-nav__list> <li class=md-nav__item> <a href=#passing-provider-to-module class=md-nav__link> Passing Provider to Module </a> </li> <li class=md-nav__item> <a href=#passing-multiple-providers class=md-nav__link> Passing multiple providers </a> </li> <li class=md-nav__item> <a href=#functions class=md-nav__link> Functions </a> </li> <li class=md-nav__item> <a href=#variables class=md-nav__link> Variables </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#outputs class=md-nav__link> Outputs </a> </li> <li class=md-nav__item> <a href=#new-in-tf-012 class=md-nav__link> new in TF 0.12 </a> </li> <li class=md-nav__item> <a href=#listof class=md-nav__link> Listof </a> <nav class=md-nav aria-label=Listof> <ul class=md-nav__list> <li class=md-nav__item> <a href=#objects class=md-nav__link> Objects </a> </li> <li class=md-nav__item> <a href=#sets class=md-nav__link> Sets </a> </li> <li class=md-nav__item> <a href=#dynamic class=md-nav__link> Dynamic </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#order class=md-nav__link> Order </a> <nav class=md-nav aria-label=Order> <ul class=md-nav__list> <li class=md-nav__item> <a href=#depends_on class=md-nav__link> depends_on </a> </li> <li class=md-nav__item> <a href=#depends_on-with-modules class=md-nav__link> depends_on with modules </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Providers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Providers data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"></span> Providers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-1 type=checkbox id=nav-6-1> <label class=md-nav__link for=nav-6-1> Utilities <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Utilities data-md-level=2> <label class=md-nav__title for=nav-6-1> <span class="md-nav__icon md-icon"></span> Utilities </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../local_file/ class=md-nav__link> Local file </a> </li> <li class=md-nav__item> <a href=../template/ class=md-nav__link> Template </a> </li> <li class=md-nav__item> <a href=../random/ class=md-nav__link> Random </a> </li> <li class=md-nav__item> <a href=../terraform/ class=md-nav__link> Terraform </a> </li> <li class=md-nav__item> <a href=../tls/ class=md-nav__link> TLS </a> </li> <li class=md-nav__item> <a href=../dns/ class=md-nav__link> DNS </a> </li> <li class=md-nav__item> <a href=../null/ class=md-nav__link> Null </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../statuscake/ class=md-nav__link> Status Cake </a> </li> <li class=md-nav__item> <a href=../pagerduty/ class=md-nav__link> Pager Duty </a> </li> <li class=md-nav__item> <a href=../docker/ class=md-nav__link> Docker </a> </li> <li class=md-nav__item> <a href=../github/ class=md-nav__link> Github </a> </li> <li class=md-nav__item> <a href=../gitlab/ class=md-nav__link> Gitlab </a> </li> <li class=md-nav__item> <a href=../consul/ class=md-nav__link> Consul </a> </li> <li class=md-nav__item> <a href=../vault/ class=md-nav__link> Vault </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Making a VPC <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Making a VPC" data-md-level=1> <label class=md-nav__title for=nav-7> <span class="md-nav__icon md-icon"></span> Making a VPC </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws-vpc/ class=md-nav__link> AWS </a> </li> <li class=md-nav__item> <a href=../gcp-vpc/ class=md-nav__link> GCP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> Creating a Subnet <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Creating a Subnet" data-md-level=1> <label class=md-nav__title for=nav-8> <span class="md-nav__icon md-icon"></span> Creating a Subnet </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws-subnet/ class=md-nav__link> AWS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9 type=checkbox id=nav-9> <label class=md-nav__link for=nav-9> Creating an Instance <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Creating an Instance" data-md-level=1> <label class=md-nav__title for=nav-9> <span class="md-nav__icon md-icon"></span> Creating an Instance </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws-instance/ class=md-nav__link> AWS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10 type=checkbox id=nav-10> <label class=md-nav__link for=nav-10> Autoscaling <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Autoscaling data-md-level=1> <label class=md-nav__title for=nav-10> <span class="md-nav__icon md-icon"></span> Autoscaling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws-autoscaling/ class=md-nav__link> AWS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-11 type=checkbox id=nav-11> <label class=md-nav__link for=nav-11> Load Balancing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Load Balancing" data-md-level=1> <label class=md-nav__title for=nav-11> <span class="md-nav__icon md-icon"></span> Load Balancing </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-11-1 type=checkbox id=nav-11-1> <label class=md-nav__link for=nav-11-1> AWS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=AWS data-md-level=2> <label class=md-nav__title for=nav-11-1> <span class="md-nav__icon md-icon"></span> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws-alb/ class=md-nav__link> Application </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-12 type=checkbox id=nav-12> <label class=md-nav__link for=nav-12> Databases <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Databases data-md-level=1> <label class=md-nav__title for=nav-12> <span class="md-nav__icon md-icon"></span> Databases </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws-rds/ class=md-nav__link> RDS </a> </li> <li class=md-nav__item> <a href=../gcp-cloudsql/ class=md-nav__link> CloudSQL </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-13 type=checkbox id=nav-13> <label class=md-nav__link for=nav-13> Storage <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Storage data-md-level=1> <label class=md-nav__title for=nav-13> <span class="md-nav__icon md-icon"></span> Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws-s3/ class=md-nav__link> S3 </a> </li> <li class=md-nav__item> <a href=../gcp-cloudstorage/ class=md-nav__link> Cloud Storage </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-14 type=checkbox id=nav-14> <label class=md-nav__link for=nav-14> IAM <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=IAM data-md-level=1> <label class=md-nav__title for=nav-14> <span class="md-nav__icon md-icon"></span> IAM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws-iam/ class=md-nav__link> AWS </a> </li> <li class=md-nav__item> <a href=../gcp-iam/ class=md-nav__link> GCP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-15 type=checkbox id=nav-15> <label class=md-nav__link for=nav-15> DNS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=DNS data-md-level=1> <label class=md-nav__title for=nav-15> <span class="md-nav__icon md-icon"></span> DNS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws-dns/ class=md-nav__link> Route 53 </a> </li> <li class=md-nav__item> <a href=../gcp-dns/ class=md-nav__link> gcp </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../adv-state/ class=md-nav__link> Advanced State </a> </li> <li class=md-nav__item> <a href=../control/ class=md-nav__link> Structure </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-18 type=checkbox id=nav-18> <label class=md-nav__link for=nav-18> Modules <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Modules data-md-level=1> <label class=md-nav__title for=nav-18> <span class="md-nav__icon md-icon"></span> Modules </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../module/ class=md-nav__link> Creating </a> </li> <li class=md-nav__item> <a href=../github-actions/ class=md-nav__link> Github Actions </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-19 type=checkbox id=nav-19> <label class=md-nav__link for=nav-19> SourceCode <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=SourceCode data-md-level=1> <label class=md-nav__title for=nav-19> <span class="md-nav__icon md-icon"></span> SourceCode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws-codecommit/ class=md-nav__link> CodeCommit </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-20 type=checkbox id=nav-20> <label class=md-nav__link for=nav-20> Containers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Containers data-md-level=1> <label class=md-nav__title for=nav-20> <span class="md-nav__icon md-icon"></span> Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-20-1 type=checkbox id=nav-20-1> <label class=md-nav__link for=nav-20-1> AWS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=AWS data-md-level=2> <label class=md-nav__title for=nav-20-1> <span class="md-nav__icon md-icon"></span> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws-ecr/ class=md-nav__link> ECR </a> </li> <li class=md-nav__item> <a href=../aws-ecs/ class=md-nav__link> ECS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-20-2 type=checkbox id=nav-20-2> <label class=md-nav__link for=nav-20-2> GCP <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=GCP data-md-level=2> <label class=md-nav__title for=nav-20-2> <span class="md-nav__icon md-icon"></span> GCP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../gcp-kubernetes/ class=md-nav__link> GKE </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-21 type=checkbox id=nav-21> <label class=md-nav__link for=nav-21> Logging <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Logging data-md-level=1> <label class=md-nav__title for=nav-21> <span class="md-nav__icon md-icon"></span> Logging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws-cloudwatch/ class=md-nav__link> Cloudwatch </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../workspaces/ class=md-nav__link> Workspaces </a> </li> <li class=md-nav__item> <a href=../tfe/ class=md-nav__link> Terraform cloud </a> </li> <li class=md-nav__item> <a href=../extending/ class=md-nav__link> Extending </a> </li> <li class=md-nav__item> <a href=../failings/ class=md-nav__link> Failings </a> </li> <li class=md-nav__item> <a href=../style-guide/ class=md-nav__link> Style Guide </a> </li> <li class=md-nav__item> <a href=../help/ class=md-nav__link> Help </a> </li> <li class=md-nav__item> <a href=../about/ class=md-nav__link> About </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#provisioners class=md-nav__link> Provisioners </a> <nav class=md-nav aria-label=Provisioners> <ul class=md-nav__list> <li class=md-nav__item> <a href=#connections class=md-nav__link> Connections </a> </li> <li class=md-nav__item> <a href=#connection-forwarding class=md-nav__link> Connection forwarding </a> </li> <li class=md-nav__item> <a href=#remote-exec class=md-nav__link> Remote-Exec </a> </li> <li class=md-nav__item> <a href=#local-exec class=md-nav__link> Local-exec </a> </li> <li class=md-nav__item> <a href=#file-provisioning class=md-nav__link> File Provisioning </a> </li> <li class=md-nav__item> <a href=#triggers class=md-nav__link> Triggers </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#resources class=md-nav__link> Resources </a> </li> <li class=md-nav__item> <a href=#providers class=md-nav__link> Providers </a> <nav class=md-nav aria-label=Providers> <ul class=md-nav__list> <li class=md-nav__item> <a href=#passing-provider-to-module class=md-nav__link> Passing Provider to Module </a> </li> <li class=md-nav__item> <a href=#passing-multiple-providers class=md-nav__link> Passing multiple providers </a> </li> <li class=md-nav__item> <a href=#functions class=md-nav__link> Functions </a> </li> <li class=md-nav__item> <a href=#variables class=md-nav__link> Variables </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#outputs class=md-nav__link> Outputs </a> </li> <li class=md-nav__item> <a href=#new-in-tf-012 class=md-nav__link> new in TF 0.12 </a> </li> <li class=md-nav__item> <a href=#listof class=md-nav__link> Listof </a> <nav class=md-nav aria-label=Listof> <ul class=md-nav__list> <li class=md-nav__item> <a href=#objects class=md-nav__link> Objects </a> </li> <li class=md-nav__item> <a href=#sets class=md-nav__link> Sets </a> </li> <li class=md-nav__item> <a href=#dynamic class=md-nav__link> Dynamic </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#order class=md-nav__link> Order </a> <nav class=md-nav aria-label=Order> <ul class=md-nav__list> <li class=md-nav__item> <a href=#depends_on class=md-nav__link> depends_on </a> </li> <li class=md-nav__item> <a href=#depends_on-with-modules class=md-nav__link> depends_on with modules </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/jamesWoolfenden/learn-terraform/edit/master/docs/syntax.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=terraform-hcl-syntax-primer>Terraform HCL syntax Primer</h1> <p>Most of what you need to know is found on the Terraform site <a href=https://www.terraform.io/docs/configuration/variables.html>https://www.terraform.io/docs/configuration/variables.html</a>. The information provided here is in addition.</p> <h2 id=provisioners>Provisioners</h2> <p>As the Terraform Docs call out <strong>"Provisioners are a Last Resort"</strong>. Heed these words, there is, and there really should be a better way of doing what your trying to do.</p> <p>Provisioners don't do state and are a horror to make idempotent, so you have less control over when they run and what they do. You can use Triggers to control execution, but creating destroy time provisioners is a good way of wasting a lot of your time.</p> <p>If you find yourself wanting to install packages at launch with <strong>remote-exec</strong> ask yourself:</p> <ul> <li>Is this something better pre-prepared in Packer - <strong>Almost definitely</strong></li> <li>If Packer is overkill then could this be done with your bootstrap load -<strong>maybe, see previous answer</strong>. The Bootstrap load should be the chance to add environment specific configuration at launch-time.</li> <li>Remember that Installing at launch is slow and could fail, so if you're spinning up because of a scaling request, you have no time to spare, and have zero room for failure.</li> <li>Remember pre-prepared always beats installing.</li> <li>With In-place updates there's always a risk of failed update and loss of use while changing, Downtime is to be avoided.</li> </ul> <h3 id=connections>Connections</h3> <p>Remote Provisioner's need authentication, probably via SSH [God forbid it <strong>winrm</strong>]. So you now have SSH key, password or certificate management issues. You also need to be on a network that allows it. You may have to connect through a bastion host.</p> <h3 id=connection-forwarding>Connection forwarding</h3> <p>TODO:Thru a Bastion</p> <p>When to use a Provisioner</p> <ul> <li>To overcome a bug in Terraform behaviour.</li> <li>No Terraform resource exists.</li> </ul> <p>When not</p> <ul> <li>Installing anything on a new instance. Terraform is for making infrastructure, and for managing "Cattle". If you find your self wanting to install a lot of components, you should be making new component via tools like Packer.</li> </ul> <h3 id=remote-exec>Remote-Exec</h3> <p>SSH onto a box after creation.</p> <h3 id=local-exec>Local-exec</h3> <p>Make something/execute on the build box during provisioning.</p> <h3 id=file-provisioning>File Provisioning</h3> <h3 id=triggers>Triggers</h3> <p>everytime triggers { build_number = "${timestamp()}" } when = "destroy"</p> <p>on create is the default</p> <p>when = "destroy"</p> <p>TODO on_failure = "continue"</p> <div class="admonition note other provisioners"> <p class=admonition-title>Note</p> <p>I have never used these provisioners, if you have some legacy scripts you want to exploit they may have be useful. Chef provisioner</p> <p>Puppet provisioner</p> <p>Habitat provisioner</p> <p>Salt-masterless Provisioner</p> </div> <h2 id=resources>Resources</h2> <p>This is the main component class in Terraform, resource are the infrastructure objects you're trying to create.</p> <h2 id=providers>Providers</h2> <h3 id=passing-provider-to-module>Passing Provider to Module</h3> <p>How do I pass the provider and its configuration into a module?</p> <p>The default provider is passed in without you seeing anything, but a non default or extra one is very different.</p> <ul> <li>define a Provider <strong>provider.secondary.tf</strong></li> </ul> <p> <div class=codehilite><pre><span></span><code><span class=kr>provider</span> <span class=s>&quot;aws&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  alias</span>   <span class=o>=</span> <span class=s2>&quot;secondary&quot;</span>
<span class=na>  region</span>  <span class=o>=</span> <span class=s2>&quot;us-east-1&quot;</span>
<span class=na>  version</span> <span class=o>=</span> <span class=s2>&quot;2.35.0&quot;</span>
<span class=" -Punctuation">}</span>
</code></pre></div></p> <p>and then pass it in the module definition <strong>module.stuff.tf</strong></p> <p> <div class=codehilite><pre><span></span><code><span class=kr>module</span> <span class=s>&quot;stuff&quot;</span> <span class=" -Punctuation">{</span>
<span class=p>...</span>
<span class=na>providers</span> <span class=o>=</span> <span class=" -Punctuation">{</span>
<span class=na>    aws</span> <span class=o>=</span> <span class=s2>&quot;aws.secondary&quot;</span>
  <span class=" -Punctuation">}</span>
<span class=" -Punctuation">}</span>
</code></pre></div></p> <p>Easy enough.</p> <h3 id=passing-multiple-providers>Passing multiple providers</h3> <p>What happens if you need to pass 2 different defined providers?</p> <p>Then define one as the default, and one with a named alias and pass them to the module.</p> <p> <div class=codehilite><pre><span></span><code><span class=kr>module</span> <span class=s>&quot;cassandra&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  source</span>        <span class=o>=</span> <span class=s2>&quot;../../&quot;</span>
<span class=na>  instance_type</span> <span class=o>=</span> <span class=err>var</span><span class=p>.</span><span class=err>instance_type</span>
<span class=na>  common_tags</span>   <span class=o>=</span> <span class=err>var</span><span class=p>.</span><span class=err>common_tags</span>
<span class=na>  providers</span> <span class=o>=</span> <span class=" -Punctuation">{</span>
<span class=na>    aws</span><span class=o>=</span><span class=err>aws</span>
<span class=na>    aws.secondary</span> <span class=o>=</span> <span class=s2>&quot;aws.useast&quot;</span>
  <span class=" -Punctuation">}</span>
<span class=" -Punctuation">}</span>
</code></pre></div></p> <p>And then you can try and reference the providers:</p> <p> <div class=codehilite><pre><span></span><code><span class=kr>resource</span> <span class=s>&quot;aws_instance&quot; &quot;remote-cassandra-node3&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  provider</span>      <span class=o>=</span> <span class=err>aws</span><span class=p>.</span><span class=err>secondary</span>
<span class=na>  key_name</span>      <span class=o>=</span> <span class=err>element</span><span class=p>(</span><span class=kr>module</span><span class=p>.</span><span class=err>ssh-key-secondary</span><span class=p>.</span><span class=err>keys</span><span class=p>,</span><span class=err> 0</span><span class=p>)</span>
<span class=na>  ami</span>           <span class=o>=</span> <span class=kr>data</span><span class=p>.</span><span class=err>aws_ami</span><span class=p>.</span><span class=err>ubuntu-secondary</span><span class=p>.</span><span class=err>image_id</span>
<span class=na>  instance_type</span> <span class=o>=</span> <span class=err>var</span><span class=p>.</span><span class=err>instance_type</span>

  <span class=err>root_block_device</span> <span class=" -Punctuation">{</span>
<span class=na>    volume_type</span>           <span class=o>=</span> <span class=s2>&quot;standard&quot;</span>
<span class=na>    volume_size</span>           <span class=o>=</span> <span class=m>100</span>
<span class=na>    delete_on_termination</span> <span class=o>=</span> <span class=kt>false</span>
  <span class=" -Punctuation">}</span>

<span class=na>  tags</span> <span class=o>=</span> <span class=err>var</span><span class=p>.</span><span class=err>common_tags</span>
<span class=" -Punctuation">}</span>
</code></pre></div></p> <p>Now I almost thought it could just be that easy, but when you plan/apply you get:</p> <div class="admonition error"> <p class=admonition-title>Error</p> <p>Error: missing provider module.cassandra.provider.aws.secondary</p> </div> <p>The answer is to create an empty Provider in your module <strong>provider.secondary.tf</strong> and your golden:</p> <p> <div class=codehilite><pre><span></span><code><span class=kr>provider</span> <span class=s>&quot;aws&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  alias</span><span class=o>=</span><span class=s2>&quot;secondary&quot;</span>
<span class=" -Punctuation">}</span>
</code></pre></div></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Samples from the module <a href=https://github.com/JamesWoolfenden/terraform-aws-cassandra>https://github.com/JamesWoolfenden/terraform-aws-cassandra</a></p> </div> <h3 id=functions>Functions</h3> <p>Are well covered here <a href=https://www.terraform.io/docs/configuration/functions.html>https://www.terraform.io/docs/configuration/functions.html</a></p> <h3 id=variables>Variables</h3> <ul> <li>strings</li> <li>maps</li> <li> <p>lists</p> </li> <li> <p>null passing blocks lists</p> </li> <li> <p>locals Terraform doesn't support interpolation of variables in variables.</p> </li> </ul> <p>So although it would be <strong>AWESOME</strong> if this worked:</p> <p> <div class=codehilite><pre><span></span><code><span class=kr>variable</span> <span class=s>&quot;name&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  default</span><span class=o>=</span><span class=s2>&quot;James&quot;</span>
<span class=" -Punctuation">}</span>

<span class=kr>variable</span> <span class=s>&quot;fullname&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  default</span><span class=o>=</span><span class=s2>&quot;${var.name} Woolfenden&quot;</span>
<span class=" -Punctuation">}</span>
</code></pre></div></p> <p>It however does not. Coff.</p> <p>However something similar can be achieved with <strong>locals</strong>:</p> <p> <div class=codehilite><pre><span></span><code><span class=kr>variable</span> <span class=s>&quot;name&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  default</span><span class=o>=</span><span class=s2>&quot;James&quot;</span>
<span class=" -Punctuation">}</span>

<span class=err>locals</span> <span class=" -Punctuation">{</span>
<span class=na>  fullname</span><span class=o>=</span><span class=s2>&quot;${var.name} Woolfenden&quot;</span>
<span class=" -Punctuation">}</span>
</code></pre></div></p> <p>To reference the local you use:</p> <p><em>local.fullname</em> instead of <em>var.fullname</em></p> <p>See the Terraform docs <a href=https://www.terraform.io/docs/configuration/locals.html>here</a></p> <h2 id=outputs>Outputs</h2> <p>I use an <strong>Outputs.tf</strong> in my templates and modules, it helps with re-use and extensibility if you pass out complex data objects to your output. This is now valid:</p> <p> <div class=codehilite><pre><span></span><code><span class=kr>output</span> <span class=s>&quot;function&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>    value</span><span class=o>=</span> <span class=err>google_cloudfunctions_function</span><span class=p>.</span><span class=err>lambda</span>
<span class=" -Punctuation">}</span>
</code></pre></div></p> <h2 id=new-in-tf-012>new in TF 0.12</h2> <h2 id=listof>Listof</h2> <p>todo</p> <h3 id=objects>Objects</h3> <p>You can define lists of a type or multiple types.</p> <p> <div class=codehilite><pre><span></span><code><span class=na>  type</span>        <span class=o>=</span> <span class=err>list</span><span class=p>(</span><span class=err>map</span><span class=p>(</span><span class=err>string</span><span class=p>))</span>
</code></pre></div></p> <p>or</p> <p> <div class=codehilite><pre><span></span><code><span class=kr>variable</span> <span class=s>&quot;database&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  type</span><span class=o>=</span><span class=err>list</span><span class=p>(</span><span class=err>object</span><span class=p>(</span><span class=" -Punctuation">{</span>
<span class=na>    name</span> <span class=o>=</span> <span class=err>string</span>
  <span class=" -Punctuation">}</span><span class=p>))</span>
<span class=na>  default</span><span class=o>=</span><span class=p>[]</span>
<span class=" -Punctuation">}</span>
</code></pre></div></p> <p>Setting the database variable:</p> <p> <div class=codehilite><pre><span></span><code><span class=err>database=[{</span>
<span class=err>        name= &quot;my-database&quot;</span>
<span class=err>    },</span>
<span class=err>    {</span>
<span class=err>        name= &quot;your-database&quot;</span>
<span class=err>    }]</span>
</code></pre></div></p> <p>When used with <strong>google_sql_database.database.tf</strong> it will create 2 databases.</p> <p> <div class=codehilite><pre><span></span><code><span class=kr>resource</span> <span class=s>&quot;google_sql_database&quot; &quot;database&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  count</span>    <span class=o>=</span> <span class=err>length</span><span class=p>(</span><span class=err>var</span><span class=p>.</span><span class=err>database</span><span class=p>)</span>
<span class=na>  name</span>     <span class=o>=</span> <span class=err>var</span><span class=p>.</span><span class=err>database</span><span class=p>[</span><span class=err>count</span><span class=p>.</span><span class=err>index</span><span class=p>][</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
<span class=na>  instance</span> <span class=o>=</span> <span class=err>google_sql_database_instance</span><span class=p>.</span><span class=err>instance</span><span class=p>.</span><span class=err>name</span>
<span class=" -Punctuation">}</span>
</code></pre></div></p> <p>This syntax enables optional creation of resources based on that object being populated, or not.</p> <h3 id=sets>Sets</h3> <p>todo</p> <h3 id=dynamic>Dynamic</h3> <p>The Dynamic keyword can be used to variable length blocks as used in this <a href=https://github.com/JamesWoolfenden/terraform-aws-codepipeline/blob/master/aws_pipeline.pipe.tf>codepipeline</a> module.</p> <p> <div class=codehilite><pre><span></span><code><span class=err>dynamic</span> <span class=s2>&quot;stage&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  for_each</span> <span class=o>=</span> <span class=p>[</span><span class=err>for</span> <span class=err>s</span> <span class=err>in</span> <span class=err>var</span><span class=p>.</span><span class=err>stages</span> <span class=err>:</span> <span class=" -Punctuation">{</span>
<span class=na>    name</span>   <span class=o>=</span> <span class=err>s</span><span class=p>.</span><span class=err>name</span>
<span class=na>    action</span> <span class=o>=</span> <span class=err>s</span><span class=p>.</span><span class=err>action</span>
  <span class=" -Punctuation">}</span><span class=p>]</span>

  <span class=err>content</span> <span class=" -Punctuation">{</span>
<span class=na>    name</span> <span class=o>=</span> <span class=err>stage</span><span class=p>.</span><span class=err>value</span><span class=p>.</span><span class=err>name</span>
    <span class=err>action</span> <span class=" -Punctuation">{</span>
<span class=na>      name</span>             <span class=o>=</span> <span class=err>stage</span><span class=p>.</span><span class=err>value</span><span class=p>.</span><span class=err>action</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
<span class=na>      owner</span>            <span class=o>=</span> <span class=err>stage</span><span class=p>.</span><span class=err>value</span><span class=p>.</span><span class=err>action</span><span class=p>[</span><span class=s2>&quot;owner&quot;</span><span class=p>]</span>
<span class=na>      version</span>          <span class=o>=</span> <span class=err>stage</span><span class=p>.</span><span class=err>value</span><span class=p>.</span><span class=err>action</span><span class=p>[</span><span class=s2>&quot;version&quot;</span><span class=p>]</span>
<span class=na>      category</span>         <span class=o>=</span> <span class=err>stage</span><span class=p>.</span><span class=err>value</span><span class=p>.</span><span class=err>action</span><span class=p>[</span><span class=s2>&quot;category&quot;</span><span class=p>]</span>
<span class=na>      provider</span>         <span class=o>=</span> <span class=err>stage</span><span class=p>.</span><span class=err>value</span><span class=p>.</span><span class=err>action</span><span class=p>[</span><span class=s2>&quot;provider&quot;</span><span class=p>]</span>
<span class=na>      input_artifacts</span>  <span class=o>=</span> <span class=err>stage</span><span class=p>.</span><span class=err>value</span><span class=p>.</span><span class=err>action</span><span class=p>[</span><span class=s2>&quot;input_artifacts&quot;</span><span class=p>]</span>
<span class=na>      output_artifacts</span> <span class=o>=</span> <span class=err>stage</span><span class=p>.</span><span class=err>value</span><span class=p>.</span><span class=err>action</span><span class=p>[</span><span class=s2>&quot;output_artifacts&quot;</span><span class=p>]</span>
<span class=na>      configuration</span>    <span class=o>=</span> <span class=err>stage</span><span class=p>.</span><span class=err>value</span><span class=p>.</span><span class=err>action</span><span class=p>[</span><span class=s2>&quot;configuration&quot;</span><span class=p>]</span>
    <span class=" -Punctuation">}</span>
  <span class=" -Punctuation">}</span>
<span class=" -Punctuation">}</span>
</code></pre></div></p> <h2 id=order>Order</h2> <p>One of the awesome things that Terraform normally just does correctly, nearly always. Sometimes it doesn't and usually thats poor design on out part, but sometimes not.</p> <h3 id=depends_on>depends_on</h3> <p>You can set the <strong>depends_on</strong> keyword on a resource to force a dependency, it shouldn't be needed.</p> <p> <div class=codehilite><pre><span></span><code><span class=kr>resource</span> <span class=s>&quot;aws_instance&quot; &quot;web&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  depends_on</span> <span class=o>=</span> <span class=p>[</span><span class=err>aws</span><span class=p>.</span><span class=err>aws_iam_instance_profile</span><span class=p>.</span><span class=err>stuff</span><span class=p>]</span><span class=c1></span>

<span class=c1>  # ...</span>
<span class=" -Punctuation">}</span>
</code></pre></div></p> <p>I have had to use this in the past on objects, and while the provider said they were created, they were actually still in the process of being created, and being replicated across regions on their way to being consistent.</p> <h3 id=depends_on-with-modules>depends_on with modules</h3> <p>Depends_on became a keyword with Terraform 0.12, you can achieve the same with 0.12.</p> <p> <div class=codehilite><pre><span></span><code><span class=kr>variable</span> <span class=s>&quot;vm_depends_on&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  type</span>    <span class=o>=</span> <span class=err>any</span>
<span class=na>  default</span> <span class=o>=</span> <span class=err>null</span>
<span class=" -Punctuation">}</span>

<span class=kr>resource</span> <span class=s>&quot;aws_instance&quot; &quot;web&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  depends_on</span> <span class=o>=</span> <span class=p>[</span><span class=err>var</span><span class=p>.</span><span class=err>vm_depends_on</span><span class=p>]</span><span class=c1></span>

<span class=c1>  # ...</span>
<span class=" -Punctuation">}</span>
</code></pre></div></p> <p>If the file above becomes part of a module:</p> <p> <div class=codehilite><pre><span></span><code><span class=kr>module</span> <span class=s>&quot;web&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  source</span> <span class=o>=</span> <span class=s2>&quot;...&quot;</span>

<span class=na>  vm_depends_on</span> <span class=o>=</span> <span class=p>[</span><span class=kr>module</span><span class=p>.</span><span class=err>anyobject</span><span class=p>.</span><span class=err>youchoose</span><span class=p>]</span>
<span class=" -Punctuation">}</span>
</code></pre></div></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>After <a href=https://discuss.hashicorp.com/t/tips-howto-implement-module-depends-on-emulation/2305/2>https://discuss.hashicorp.com/t/tips-howto-implement-module-depends-on-emulation/2305/2</a></p> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../state/ class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> State </div> </div> </a> <a href=../local_file/ class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Local file </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019 - 2021 James Woolfenden </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/jameswoolfenden target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://twitter.com/JimWoolfenden target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://www.linkedin.com/in/jameswoolfenden/ target=_blank rel=noopener title=www.linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/vendor.18f0862e.min.js></script> <script src=../assets/javascripts/bundle.994580cf.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "..",
          features: ['navigation.tabs', 'navigation.instant'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>